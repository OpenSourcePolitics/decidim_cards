---
query:
  model: true
  sql: |
    select decidim_follows.*, decidim_proposals_proposals.decidim_component_id, url as followable_url, title as followable_title
        from decidim_follows
            join {{#proposals}} decidim_proposals_proposals on decidim_proposals_proposals.id = decidim_followable_id
        where decidim_followable_type = 'Decidim::Proposals::Proposal'
    union all
        select decidim_follows.*, decidim_components.id, component_url as followable_url, ps_title as followable_title
        from decidim_follows
            join {{#components}} decidim_components on decidim_components.ps_id = decidim_followable_id and ps_participatory_space_type = decidim_followable_type
    union all
        select decidim_follows.*, decidim_debates_debates.decidim_component_id, debate_url as followable_url, title as followable_title
        from decidim_follows
            join {{#debates}} decidim_debates_debates on decidim_debates_debates.id = decidim_followable_id
        where decidim_followable_type = 'Decidim::Debates::Debate'
    union all
        select decidim_follows.*, decidim_blogs_posts.decidim_component_id, post_url as followable_url, title as followable_title
        from decidim_follows
            join {{#blogs_posts}} decidim_blogs_posts on decidim_blogs_posts.id = decidim_followable_id
        where decidim_followable_type = 'Decidim::Blogs::Post'
    union all
        select decidim_follows.*, -1 as decidim_component_id, '' as followable_url, '' as followable_title
        from decidim_follows
            join {{#users}} decidim_users on decidim_users.id = decidim_followable_id
        where decidim_followable_type = 'Decidim::UserBaseEntity'
    union all
        select decidim_follows.*, decidim_component_id, meeting_url as followable_url, title as followable_title
        from decidim_follows
            join {{#meetings}} decidim_meetings on decidim_meetings.id = decidim_followable_id
        where decidim_followable_type = 'Decidim::Meetings::Meeting'
    union all
        select decidim_follows.*, decidim_component_id, project_url as followable_url, title as followable_title
        from decidim_follows
            join {{#budgets_projects}} decidim_budgets_projects on decidim_budgets_projects.id = decidim_followable_id
        where decidim_followable_type = 'Decidim::Budgets::Project'
  info:
    meta:
      depends_on:
        - proposals
        - components
        - debates
        - blogs_posts
        - users
        - meetings
        - budgets_projects
    viz_settings:
